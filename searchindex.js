Search.setIndex({"docnames": ["index", "nshap", "usage/examples", "usage/installation", "usage/notebooks/Example1", "usage/notebooks/Example2", "usage/notebooks/Example3"], "filenames": ["index.rst", "nshap.rst", "usage/examples.rst", "usage/installation.rst", "usage/notebooks/Example1.ipynb", "usage/notebooks/Example2.ipynb", "usage/notebooks/Example3.ipynb"], "titles": ["Welcome to the Documentation of the nshap Package!", "Documentation", "Examples", "Installation", "Example 1: Interaction Indices for a Gradient Boosted Tree on the Folktables Income data set", "Example 2: An Illustration of Recovery for a Function with Variable Interactions", "Example 3: Custom value functions"], "terms": {"instal": 0, "exampl": [0, 1], "1": [0, 1, 2, 5], "interact": [0, 2], "gradient": [0, 2], "boost": [0, 2], "tree": [0, 2], "folktabl": [0, 2], "incom": [0, 2], "data": [0, 1, 2], "set": [0, 1, 2], "2": [0, 1, 2, 4, 6], "an": [0, 1, 2], "illustr": [0, 2], "recoveri": [0, 2], "function": [0, 2], "variabl": [0, 2, 4], "3": [0, 1, 2, 5], "custom": [0, 2], "valu": [0, 2], "comput": [0, 2], "The": [0, 2, 6], "interactionindex": 0, "class": 0, "plot": [0, 2, 4], "util": 0, "index": [0, 1, 2], "modul": 0, "search": 0, "page": 0, "nshap": [1, 3, 4, 5, 6], "banzhaf_interaction_index": [1, 6], "x": [1, 4, 5], "v_func": [1, 6], "n": [1, 2, 6], "banzhaf": [1, 6], "http": [1, 2], "link": 1, "springer": 1, "com": 1, "articl": 1, "10": [1, 4, 5], "1007": 1, "s001820050125": 1, "point": 1, "all": [1, 4], "": [1, 2], "given": 1, "coalit": 1, "paramet": 1, "numpi": [1, 5], "ndarrai": 1, "A": [1, 4], "It": 1, "take": [1, 4], "two": [1, 4], "argument": 1, "datapoint": 1, "list": 1, "int": 1, "order": [1, 2, 4], "up": [1, 4], "which": 1, "shaplei": [1, 2, 6], "should": 1, "return": [1, 5, 6], "type": 1, "faith_banzhaf": [1, 6], "faith": [1, 2], "arxiv": [1, 2], "org": [1, 2], "ab": [1, 2], "2203": [1, 2], "00870": [1, 2], "option": 1, "d": [1, 4], "default": 1, "faith_shap": [1, 4, 6], "shap": [1, 2], "moebius_transform": 1, "moebiu": 1, "transform": [1, 4], "n_shapley_valu": [1, 4, 5], "thi": [1, 2], "provid": [1, 2], "exact": 1, "2209": 1, "04012": 1, "via": [1, 3], "definit": 1, "shapley_interaction_index": [1, 6], "shapley_taylor": [1, 4, 6], "taylor": [1, 2, 6], "1902": 1, "05622": 1, "shapley_valu": [1, 4, 5], "origin": 1, "accord": 1, "formula": 1, "validate_input": 1, "vfunc": [1, 4, 5], "interventional_shap": [1, 4, 5], "f": [1, 4, 5, 6], "target": [1, 4], "none": 1, "num_sampl": 1, "1000": [1, 5], "random_st": [1, 4], "meomiz": 1, "true": [1, 4], "approxim": 1, "intervent": 1, "In": 1, "i": [1, 4, 5], "sampl": 1, "onc": 1, "fix": 1, "evalu": 1, "explain": [1, 4], "Will": 1, "call": 1, "where": 1, "ha": [1, 4], "shape": 1, "_type_": 1, "from": [1, 2, 5], "distribut": 1, "requir": 1, "output": 1, "multi": 1, "dimension": 1, "number": 1, "drawn": 1, "estim": 1, "random": [1, 5], "state": [1, 4], "pass": 1, "np": [1, 5, 6], "default_rng": 1, "us": [1, 3, 4], "reproduc": 1, "bool": 1, "whether": 1, "vaue": 1, "memoized_vfunc": 1, "func": 1, "base": 1, "object": 1, "decor": 1, "handl": 1, "hashabl": 1, "hash": 1, "depend": [1, 2], "onli": 1, "ar": [1, 2, 4], "subset": 1, "coordin": 1, "abl": 1, "help": 1, "avoid": 1, "duplic": 1, "even": 1, "we": 1, "perform": 1, "involv": 1, "same": [1, 2], "term": 1, "multipl": 1, "time": [1, 4], "wiki": 1, "python": 1, "moin": 1, "pythondecoratorlibrari": 1, "index_typ": 1, "str": 1, "userdict": 1, "differ": 1, "dict": 1, "ad": 1, "copi": 1, "current": 1, "get_index_typ": 1, "see": 1, "descript": 1, "get_input_dimens": 1, "input": [1, 4], "dimens": [1, 4], "integ": 1, "get_ord": 1, "k_shapley_valu": [1, 4], "k": 1, "lower": 1, "desir": 1, "nshapleyvalu": 1, "arg": 1, "kwarg": 1, "gener": 1, "simpli": 1, "plot_n_shaplei": 1, "axi": 1, "matplotlib": [1, 4, 5], "save": [1, 4], "fname": 1, "json": [1, 4], "file": [1, 4], "filenam": 1, "shalei": 1, "If": [1, 4], "you": [1, 3, 4], "prefer": 1, "self": 1, "sum": 1, "invovl": 1, "For": 1, "mani": 1, "result": [1, 4, 6], "equal": [1, 4], "attempt": 1, "minu": 1, "empti": 1, "float": 1, "plot_interaction_index": 1, "max_degre": 1, "feature_nam": [1, 4], "rotat": 1, "70": 1, "legend": 1, "fig_kwarg": 1, "figsiz": [1, 5], "6": [1, 4, 5], "barwidth": 1, "0": [1, 4, 5, 6], "5": [1, 2, 4, 5], "paper": [1, 2], "want": 1, "effect": 1, "larger": 1, "than": 1, "singl": 1, "color": 1, "label": 1, "hand": 1, "down": 1, "figur": [1, 4], "widht": 1, "bar": 1, "allclos": [1, 4], "dict1": 1, "dict2": 1, "rtol": 1, "1e": 1, "05": 1, "atol": 1, "08": 1, "compar": [1, 2], "close": [1, 4], "test": [1, 4], "purpos": 1, "first": 1, "second": 1, "load": [1, 2], "powerset": 1, "iter": 1, "doc": 1, "librari": [1, 4], "itertool": [1, 5], "html": 1, "recip": 1, "read_remov": 1, "kei": 1, "read": 1, "remov": 1, "to_int_tupl": 1, "str_tupl": 1, "convert": 1, "string": 1, "represent": [1, 2], "tupl": 1, "back": 1, "representaiton": 1, "indic": 2, "train": 2, "classifi": 2, "defin": [2, 6], "let": 2, "packag": [2, 3], "now": 2, "u": 2, "repeat": 2, "exercis": 2, "consist": 2, "mostli": 2, "so": [2, 4], "partial": 2, "don": 2, "t": 2, "have": [2, 4], "ani": 2, "clear": 2, "structur": 2, "gam": 2, "These": 2, "section": 2, "To": 3, "pip": 3, "run": [3, 4], "can": 3, "import": [3, 4, 5, 6], "xgboost": 4, "acsdatasourc": 4, "acsincom": 4, "sklearn": 4, "preprocess": 4, "standardscal": 4, "model_select": 4, "train_test_split": 4, "metric": 4, "accuracy_scor": 4, "pyplot": [4, 5], "plt": [4, 5], "seaborn": [4, 5, 6], "sn": [4, 5, 6], "set_styl": [4, 5, 6], "whitegrid": [4, 5, 6], "set_context": [4, 5, 6], "notebook": [4, 5, 6], "rc": [4, 5, 6], "ax": [4, 5, 6], "linewidth": [4, 5, 6], "grid": [4, 5, 6], "font_scal": [4, 5, 6], "data_sourc": 4, "survey_year": 4, "2016": 4, "horizon": 4, "year": 4, "survei": 4, "person": 4, "root_dir": 4, "get_data": 4, "ca": 4, "download": 4, "y": [4, 5], "_": 4, "df_to_numpi": 4, "featur": [4, 5], "zero": [4, 6], "mean": 4, "unit": 4, "varianc": 4, "fit_transform": 4, "split": 4, "x_train": [4, 5], "x_test": [4, 5], "y_train": 4, "y_test": 4, "train_siz": 4, "8": [4, 5], "reduc": 4, "speed": 4, "4": [4, 5, 6], "gbtree": 4, "xgbclassifi": 4, "fit": 4, "print": [4, 6], "accuraci": 4, "predict": 4, "3f": 4, "830": 4, "predict_proba": 4, "about": 4, "minut": 4, "cpu": 4, "total": 4, "58min": 4, "39": 4, "wall": 4, "4min": 4, "7": [4, 5, 6], "pre": 4, "instead": 4, "9": [4, 5], "lt": 4, "axessubplot": 4, "titl": [4, 5], "center": 4, "gt": 4, "show": [4, 5], "11": [4, 6], "12": 4, "13": [4, 6], "initj": 4, "14": [4, 6], "force_plot": 4, "visual": 4, "omit": 4, "javascript": 4, "wa": 4, "anoth": 4, "user": 4, "must": 4, "also": 4, "trust": 4, "view": 4, "github": 4, "been": 4, "strip": 4, "secur": 4, "jupyterlab": 4, "error": 4, "becaus": 4, "extens": 4, "yet": 4, "written": 4, "15": [4, 5], "kernelexplain": 4, "kmean": 4, "25": [4, 5], "shap_valu": 4, "16": [4, 5, 6], "expected_valu": 4, "17": [4, 6], "shapely_taylor": 4, "18": 4, "19": 4, "20": 4, "both": 4, "m\u00f6biu": 4, "get": 4, "pictur": 4, "abov": 4, "21": 4, "22": 4, "more": 4, "might": 4, "come": 4, "futur": 4, "again": 4, "everi": 4, "k_shapely_taylor": 4, "23": 4, "almost": 4, "veri": 4, "comparison": 4, "reveal": 4, "howev": 4, "thei": 4, "exactli": 4, "24": 4, "confirm": 4, "fals": [4, 5], "26": 4, "27": 4, "28": 4, "29": 4, "30": 4, "k_faith_shap": 4, "31": 4, "32": 4, "similar": 4, "actual": 4, "cm": 5, "product": 5, "seed": 5, "123": 5, "normal": 5, "loc": 5, "size": 5, "100": 5, "def": [5, 6], "ndim": 5, "8439518219711026": 5, "append": 5, "scatterplot": 5, "xlabel": 5, "ylabel": 5, "compon": 5, "fuction": 5, "arang": 5, "meshgrid": 5, "z": 5, "arrai": 5, "j": 5, "rang": 5, "reshap": 5, "fig": 5, "subplot": 5, "subplot_kw": 5, "project": 5, "3d": 5, "surf": 5, "plot_surfac": 5, "cmap": 5, "coolwarm": 5, "antialias": 5, "set_zlim": 5, "zaxi": 5, "set_major_formatt": 5, "02f": 5, "labelpad": 5, "math": 6, "p": 6, "len": 6, "comb": 6, "l": 6, "shapley_interact": 6, "banzhaf_interact": 6, "els": 6, "5000000000001867": 6, "500000000000185": 6, "4999999999999939": 6, "5087890624999979": 6, "5087890624999989": 6, "9545454545463214": 6, "09090909090923938": 6, "10000000000002415": 6, "759281940243e": 6, "11367187500000073": 6, "0771484374999503": 6, "11367187499999737": 6, "6486811915683575e": 6, "7552626019323725e": 6, "7755575615628914e": 6, "0087890625": 6, "008789062500008604": 6, "9545454545460967": 6, "19090909090925617": 6, "7941871866564725e": 6, "10000000000000021": 6, "21367187500000198": 6, "0771484374999574": 6, "21367187499998952": 6}, "objects": {"nshap.InteractionIndex": [[1, 0, 1, "", "InteractionIndex"]], "nshap.InteractionIndex.InteractionIndex": [[1, 1, 1, "", "copy"], [1, 1, 1, "", "get_index_type"], [1, 1, 1, "", "get_input_dimension"], [1, 1, 1, "", "get_order"], [1, 1, 1, "", "k_shapley_values"], [1, 1, 1, "", "plot"], [1, 1, 1, "", "save"], [1, 1, 1, "", "shapley_values"], [1, 1, 1, "", "sum"]], "nshap": [[1, 2, 0, "-", "functions"], [1, 2, 0, "-", "plot"], [1, 2, 0, "-", "util"], [1, 2, 0, "-", "vfunc"]], "nshap.functions": [[1, 3, 1, "", "banzhaf_interaction_index"], [1, 3, 1, "", "faith_banzhaf"], [1, 3, 1, "", "faith_shap"], [1, 3, 1, "", "moebius_transform"], [1, 3, 1, "", "n_shapley_values"], [1, 3, 1, "", "shapley_interaction_index"], [1, 3, 1, "", "shapley_taylor"], [1, 3, 1, "", "shapley_values"], [1, 3, 1, "", "validate_inputs"]], "nshap.plot": [[1, 3, 1, "", "plot_interaction_index"]], "nshap.util": [[1, 3, 1, "", "allclose"], [1, 3, 1, "", "load"], [1, 3, 1, "", "powerset"], [1, 3, 1, "", "read_remove"], [1, 3, 1, "", "save"], [1, 3, 1, "", "to_int_tuple"]], "nshap.vfunc": [[1, 3, 1, "", "interventional_shap"], [1, 0, 1, "", "memoized_vfunc"]]}, "objtypes": {"0": "py:class", "1": "py:method", "2": "py:module", "3": "py:function"}, "objnames": {"0": ["py", "class", "Python class"], "1": ["py", "method", "Python method"], "2": ["py", "module", "Python module"], "3": ["py", "function", "Python function"]}, "titleterms": {"welcom": 0, "document": [0, 1], "nshap": 0, "packag": [0, 4], "content": [0, 2], "indic": [0, 1, 4, 6], "tabl": [0, 6], "function": [1, 4, 5, 6], "comput": [1, 4, 6], "interact": [1, 4, 5, 6], "valu": [1, 4, 5, 6], "The": [1, 5], "interactionindex": 1, "class": 1, "plot": [1, 5], "util": 1, "exampl": [2, 4, 5, 6], "instal": 3, "1": [4, 6], "gradient": 4, "boost": 4, "tree": 4, "folktabl": 4, "incom": 4, "data": [4, 6], "set": 4, "load": 4, "train": 4, "classifi": 4, "defin": 4, "n": 4, "shaplei": [4, 5], "from": [4, 6], "we": [4, 6], "can": [4, 6], "obtain": 4, "3": [4, 6], "interventaion": 4, "shap": [4, 6], "usual": 4, "let": 4, "": [4, 6], "compar": 4, "thi": [4, 5, 6], "now": 4, "u": 4, "repeat": 4, "exercis": 4, "taylor": 4, "index": 4, "same": 4, "faith": [4, 6], "2": 5, "an": 5, "illustr": 5, "recoveri": 5, "variabl": 5, "consist": 5, "mostli": 5, "order": 5, "so": 5, "partial": 5, "depend": [5, 6], "don": 5, "t": 5, "have": 5, "ani": 5, "clear": 5, "structur": 5, "provid": 5, "represent": 5, "gam": 5, "custom": 6, "These": 6, "ar": 6, "section": 6, "5": 6, "paper": 6, "http": 6, "arxiv": 6, "org": 6, "ab": 6, "2203": 6, "00870": 6, "A": 6, "take": 6, "two": 6, "argument": 6, "singl": 6, "point": 6, "x": 6, "numpi": 6, "ndarrai": 6, "python": 6, "list": 6, "coordin": 6, "belong": 6, "coaltion": 6, "In": 6, "doe": 6, "actual": 6, "equip": 6, "differ": 6, "kind": 6, "replic": 6}, "envversion": {"sphinx.domains.c": 3, "sphinx.domains.changeset": 1, "sphinx.domains.citation": 1, "sphinx.domains.cpp": 9, "sphinx.domains.index": 1, "sphinx.domains.javascript": 3, "sphinx.domains.math": 2, "sphinx.domains.python": 4, "sphinx.domains.rst": 2, "sphinx.domains.std": 2, "nbsphinx": 4, "sphinx": 60}, "alltitles": {"Welcome to the Documentation of the nshap Package!": [[0, "welcome-to-the-documentation-of-the-nshap-package"]], "Contents:": [[0, null], [2, null]], "Indices and tables": [[0, "indices-and-tables"]], "Documentation": [[1, "documentation"]], "Functions that compute interaction indices": [[1, "module-nshap.functions"]], "Value Functions": [[1, "module-nshap.vfunc"]], "The InteractionIndex class": [[1, "the-interactionindex-class"]], "Plotting and Utilities": [[1, "module-nshap.plot"]], "Examples": [[2, "examples"]], "Installation": [[3, "installation"]], "Example 1: Interaction Indices for a Gradient Boosted Tree on the Folktables Income data set": [[4, "Example-1:-Interaction-Indices-for-a-Gradient-Boosted-Tree-on-the-Folktables-Income-data-set"]], "Load the data": [[4, "Load-the-data"]], "Train the classifier": [[4, "Train-the-classifier"]], "Define the value function": [[4, "Define-the-value-function"]], "Compute n-Shapley Values": [[4, "Compute-n-Shapley-Values"]], "From the n-Shapley Values, we can obtain the 3-Shapley Values": [[4, "From-the-n-Shapley-Values,-we-can-obtain-the-3-Shapley-Values"]], "\u2026 Shapley Interaction Values (with the interventaional Shap Value function, these the SHAP interaction values from the shap package)": [[4, "...-Shapley-Interaction-Values-(with-the-interventaional-Shap-Value-function,-these-the-SHAP-interaction-values-from-the-shap-package)"]], "\u2026 and the usual Shapley Values": [[4, "...-and-the-usual-Shapley-Values"]], "Let\u2019s compare this to the Shapley Values from the shap package": [[4, "Let's-compare-this-to-the-Shapley-Values-from-the-shap-package"]], "Now, let us repeat this exercise with the the Shapley Taylor interaction index": [[4, "Now,-let-us-repeat-this-exercise-with-the-the-Shapley-Taylor-interaction-index"]], "Now, the same exercise for Faith-Shap interaction index": [[4, "Now,-the-same-exercise-for-Faith-Shap-interaction-index"]], "Example 2: An Illustration of Recovery for a Function with Variable Interactions": [[5, "Example-2:-An-Illustration-of-Recovery-for-a-Function-with-Variable-Interactions"]], "The function": [[5, "The-function"]], "This function consists mostly of variable interaction of order 2, so the partial dependence plots of Shapley Values don\u2019t have any clear structure": [[5, "This-function-consists-mostly-of-variable-interaction-of-order-2,-so-the-partial-dependence-plots-of-Shapley-Values-don't-have-any-clear-structure"]], "2-Shapley Values provide a representation of the function as a GAM": [[5, "2-Shapley-Values-provide-a-representation-of-the-function-as-a-GAM"]], "Example 3: Custom value functions": [[6, "Example-3:-Custom-value-functions"]], "These examples are from section 5.1 of the Faith-Shap paper: https://arxiv.org/abs/2203.00870": [[6, "These-examples-are-from-section-5.1-of-the-Faith-Shap-paper:-https://arxiv.org/abs/2203.00870"]], "Example 1": [[6, "Example-1"]], "A value function takes two arguments: A single data point x (a numpy.ndarray) and a python list S with the indices the the coordinates that belong to the coaltion.": [[6, "A-value-function-takes-two-arguments:-A-single-data-point-x-(a-numpy.ndarray)-and-a-python-list-S-with-the-indices-the-the-coordinates-that-belong-to-the-coaltion."]], "In this example, the value does not actually depend on the point x": [[6, "In-this-example,-the-value-does-not-actually-depend-on-the-point-x"]], "Equipped with the value function, we can compute different kinds of interaction indices": [[6, "Equipped-with-the-value-function,-we-can-compute-different-kinds-of-interaction-indices"]], "We can replicate Table 1 in the Faith-Shap paper": [[6, "We-can-replicate-Table-1-in-the-Faith-Shap-paper"]]}, "indexentries": {"interactionindex (class in nshap.interactionindex)": [[1, "nshap.InteractionIndex.InteractionIndex"]], "allclose() (in module nshap.util)": [[1, "nshap.util.allclose"]], "banzhaf_interaction_index() (in module nshap.functions)": [[1, "nshap.functions.banzhaf_interaction_index"]], "copy() (nshap.interactionindex.interactionindex method)": [[1, "nshap.InteractionIndex.InteractionIndex.copy"]], "faith_banzhaf() (in module nshap.functions)": [[1, "nshap.functions.faith_banzhaf"]], "faith_shap() (in module nshap.functions)": [[1, "nshap.functions.faith_shap"]], "get_index_type() (nshap.interactionindex.interactionindex method)": [[1, "nshap.InteractionIndex.InteractionIndex.get_index_type"]], "get_input_dimension() (nshap.interactionindex.interactionindex method)": [[1, "nshap.InteractionIndex.InteractionIndex.get_input_dimension"]], "get_order() (nshap.interactionindex.interactionindex method)": [[1, "nshap.InteractionIndex.InteractionIndex.get_order"]], "interventional_shap() (in module nshap.vfunc)": [[1, "nshap.vfunc.interventional_shap"]], "k_shapley_values() (nshap.interactionindex.interactionindex method)": [[1, "nshap.InteractionIndex.InteractionIndex.k_shapley_values"]], "load() (in module nshap.util)": [[1, "nshap.util.load"]], "memoized_vfunc (class in nshap.vfunc)": [[1, "nshap.vfunc.memoized_vfunc"]], "module": [[1, "module-nshap.functions"], [1, "module-nshap.plot"], [1, "module-nshap.util"], [1, "module-nshap.vfunc"]], "moebius_transform() (in module nshap.functions)": [[1, "nshap.functions.moebius_transform"]], "n_shapley_values() (in module nshap.functions)": [[1, "nshap.functions.n_shapley_values"]], "nshap.functions": [[1, "module-nshap.functions"]], "nshap.plot": [[1, "module-nshap.plot"]], "nshap.util": [[1, "module-nshap.util"]], "nshap.vfunc": [[1, "module-nshap.vfunc"]], "plot() (nshap.interactionindex.interactionindex method)": [[1, "nshap.InteractionIndex.InteractionIndex.plot"]], "plot_interaction_index() (in module nshap.plot)": [[1, "nshap.plot.plot_interaction_index"]], "powerset() (in module nshap.util)": [[1, "nshap.util.powerset"]], "read_remove() (in module nshap.util)": [[1, "nshap.util.read_remove"]], "save() (in module nshap.util)": [[1, "nshap.util.save"]], "save() (nshap.interactionindex.interactionindex method)": [[1, "nshap.InteractionIndex.InteractionIndex.save"]], "shapley_interaction_index() (in module nshap.functions)": [[1, "nshap.functions.shapley_interaction_index"]], "shapley_taylor() (in module nshap.functions)": [[1, "nshap.functions.shapley_taylor"]], "shapley_values() (in module nshap.functions)": [[1, "nshap.functions.shapley_values"]], "shapley_values() (nshap.interactionindex.interactionindex method)": [[1, "nshap.InteractionIndex.InteractionIndex.shapley_values"]], "sum() (nshap.interactionindex.interactionindex method)": [[1, "nshap.InteractionIndex.InteractionIndex.sum"]], "to_int_tuple() (in module nshap.util)": [[1, "nshap.util.to_int_tuple"]], "validate_inputs() (in module nshap.functions)": [[1, "nshap.functions.validate_inputs"]]}})